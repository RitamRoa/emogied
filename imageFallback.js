const emojiMap = {
    dog: ['ðŸ¶', 'ðŸ•', 'ðŸ©'],
    cat: ['ðŸ±', 'ðŸˆ'],
    pizza: ['ðŸ•'],
    book: ['ðŸ“š', 'ðŸ“–', 'ðŸ“•', 'ðŸ“—', 'ðŸ“˜', 'ðŸ“™'],
    car: ['ðŸš—', 'ðŸš™', 'ðŸŽï¸', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸšš', 'ðŸš›', 'ðŸšœ'],
    computer: ['ðŸ’»', 'ðŸ–¥ï¸', 'âŒ¨ï¸'],
    code: ['ðŸ’»', 'ðŸ“œ', 'ðŸ‘¨â€ðŸ’»', 'ðŸ‘©â€ðŸ’»'],
    javascript: ['ðŸ“œ', 'ðŸ’›'],
    python: ['ðŸ'],
    react: ['âš›ï¸'],
    angular: ['ðŸ…°ï¸'],
    vue: ['ðŸ––'],
    node: ['ðŸŸ©'],
    server: ['ðŸ–¥ï¸', 'ðŸ—„ï¸'],
    database: ['ðŸ—„ï¸', 'ðŸ’¾'],
    cloud: ['â˜ï¸'],
    weather: ['ðŸŒ¦ï¸', 'â˜€ï¸', 'ðŸŒ§ï¸', 'â„ï¸', 'ðŸŒªï¸'],
    sun: ['â˜€ï¸', 'ðŸŒž'],
    moon: ['ðŸŒ™', 'ðŸŒ•', 'ðŸŒ‘'],
    star: ['â­', 'ðŸŒŸ', 'âœ¨'],
    flower: ['ðŸŒ¸', 'ðŸŒ¹', 'ðŸŒ·', 'ðŸŒ»', 'ðŸŒ¼'],
    tree: ['ðŸŒ³', 'ðŸŒ²', 'ðŸŒ´'],
    food: ['ðŸ”', 'ðŸ•', 'ðŸŸ', 'ðŸŽ', 'ðŸ¥¦', 'ðŸ£'],
    fruit: ['ðŸŽ', 'ðŸŒ', 'ðŸ‡', 'ðŸ“', 'ðŸ‰'],
    vegetable: ['ðŸ¥¦', 'ðŸ¥•', 'ðŸŒ½', 'ðŸ†', 'ðŸ…'],
    money: ['ðŸ’°', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸª™'],
    love: ['â¤ï¸', 'ðŸ’–', 'ðŸ’•', 'ðŸ˜', 'ðŸ˜˜'],
    heart: ['â¤ï¸', 'ðŸ’”', 'ðŸ’–', 'ðŸ’•', 'ðŸ’“', 'ðŸ’œ', 'ðŸ’™', 'ðŸ’š', 'ðŸ’›'],
    music: ['ðŸŽµ', 'ðŸŽ¶', 'ðŸŽ¸', 'ðŸŽ¹', 'ðŸŽº', 'ðŸŽ»', 'ðŸ¥'],
    movie: ['ðŸŽ¬', 'ðŸŽ¥', 'ðŸŽžï¸', 'ðŸ“½ï¸'],
    game: ['ðŸŽ®', 'ðŸŽ²', 'â™Ÿï¸', 'ðŸ•¹ï¸'],
    sport: ['âš½', 'ðŸ€', 'ðŸˆ', 'âš¾', 'ðŸŽ¾'],
    ball: ['ðŸ€', 'âš½', 'ðŸˆ', 'âš¾', 'ðŸŽ¾', 'ðŸ'],
    travel: ['âœˆï¸', 'ðŸš€', 'ðŸš‚', 'ðŸš¢', 'ðŸŒ'],
    world: ['ðŸŒ', 'ðŸŒŽ', 'ðŸŒ'],
    usa: ['ðŸ‡ºðŸ‡¸', 'ðŸ¦…'],
    india: ['ðŸ‡®ðŸ‡³', 'ðŸ¦š'],
    uk: ['ðŸ‡¬ðŸ‡§'],
    canada: ['ðŸ‡¨ðŸ‡¦'],
    australia: ['ðŸ‡¦ðŸ‡º', 'ðŸ¨', 'ðŸ¦˜'],
    japan: ['ðŸ‡¯ðŸ‡µ', 'ðŸŒ¸', 'ðŸ£'],
    china: ['ðŸ‡¨ðŸ‡³', 'ðŸ¼', 'ðŸ‰'],
    germany: ['ðŸ‡©ðŸ‡ª', 'ðŸº'],
    france: ['ðŸ‡«ðŸ‡·', 'ðŸ·', 'ðŸ¥'],
    brazil: ['ðŸ‡§ðŸ‡·', 'âš½'],
    russia: ['ðŸ‡·ðŸ‡º'],
    mexico: ['ðŸ‡²ðŸ‡½', 'ðŸŒ®'],
    spain: ['ðŸ‡ªðŸ‡¸', 'ðŸ’ƒ'],
    italy: ['ðŸ‡®ðŸ‡¹', 'ðŸ•', 'ðŸ'],
    korea: ['ðŸ‡°ðŸ‡·'],
    coffee: ['â˜•'],
    tea: ['ðŸµ'],
    beer: ['ðŸº', 'ðŸ»'],
    wine: ['ðŸ·', 'ðŸ‡'],
    cocktail: ['ðŸ¸', 'ðŸ¹'],
    party: ['ðŸŽ‰', 'ðŸŽŠ', 'ðŸŽˆ'],
    birthday: ['ðŸŽ‚', 'ðŸŽ'],
    christmas: ['ðŸŽ„', 'ðŸŽ…', 'ðŸŽ'],
    halloween: ['ðŸŽƒ', 'ðŸ‘»', 'ðŸ’€'],
    newyear: ['ðŸŽ†', 'ðŸŽ‡'],
    congratulations: ['ðŸŽŠ', 'ðŸŽ‰'],
    thankyou: ['ðŸ™'],
    sorry: ['ðŸ˜¥', 'ðŸ˜”'],
    help: ['ðŸ†˜', 'ðŸ™‹'],
    idea: ['ðŸ’¡'],
    question: ['â“', 'â”'],
    warning: ['âš ï¸'],
    error: ['âŒ', 'â—'],
    success: ['âœ…', 'ðŸ‘'],
    check: ['âœ”ï¸', 'â˜‘ï¸'],
    github: ['ðŸ™', 'ðŸ‘¨â€ðŸ’»', 'ðŸ‘©â€ðŸ’»'],
    twitter: ['ðŸ¦'],
    facebook: ['ðŸ‘', 'ðŸ’™'],
    instagram: ['ðŸ“¸'],
    linkedin: ['ðŸ’¼'],
    youtube: ['ðŸ“º', 'â–¶ï¸'],
    slack: ['ðŸ’¬'],
    discord: ['ðŸŽ®'],
    skype: ['ðŸ“ž'],
    whatsapp: ['ðŸ“±'],
    email: ['ðŸ“§', 'âœ‰ï¸'],
    phone: ['â˜Žï¸', 'ðŸ“ž', 'ðŸ“±'],
    home: ['ðŸ ', 'ðŸ¡'],
    house: ['ðŸ¡', 'ðŸ '],
    office: ['ðŸ¢', 'ðŸ’¼'],
    school: ['ðŸ«', 'ðŸŽ“'],
    hospital: ['ðŸ¥', 'âš•ï¸'],
    bank: ['ðŸ¦', 'ðŸ’°'],
    hotel: ['ðŸ¨'],
    shop: ['ðŸ¬', 'ðŸ›ï¸'],
    store: ['ðŸª', 'ðŸ›’'],
    market: ['ðŸ›’', 'ðŸ“ˆ', 'ðŸ“‰'],
    restaurant: ['ðŸ´', 'ðŸ', 'ðŸœ'],
    cafe: ['â˜•', 'ðŸ¥'],
    bar: ['ðŸ»', 'ðŸ¸'],
    park: ['ðŸžï¸', 'ðŸŒ³'],
    beach: ['ðŸ–ï¸', 'ðŸŒŠ', 'â˜€ï¸'],
    mountain: ['â›°ï¸', 'ðŸ”ï¸'],
    forest: ['ðŸŒ²', 'ðŸŒ³'],
    city: ['ðŸ™ï¸', 'ðŸŒ‡', 'ðŸŒƒ'],
    town: ['ðŸ˜ï¸'],
    village: ['ðŸ¡'],
    bridge: ['ðŸŒ‰'],
    road: ['ðŸ›£ï¸', 'ðŸš—'],
    train: ['ðŸš†', 'ðŸš‚', 'ðŸš„'],
    bus: ['ðŸšŒ'],
    taxi: ['ðŸš•', 'ðŸš–'],
    bicycle: ['ðŸš²', 'ðŸš´'],
    motorcycle: ['ðŸï¸'],
    ship: ['ðŸš¢', 'ðŸ›³ï¸', 'â›´ï¸'],
    boat: ['â›µ', 'ðŸš¤'],
    rocket: ['ðŸš€'],
    fire: ['ðŸ”¥', 'ðŸš’'],
    water: ['ðŸ’§', 'ðŸŒŠ', 'ðŸ’¦'],
    earth: ['ðŸŒŽ', 'ðŸŒ', 'ðŸŒ'],
    air: ['ðŸ’¨', 'ðŸŒ¬ï¸'],
    science: ['ðŸ”¬', 'âš—ï¸', 'ðŸ§¬'],
    art: ['ðŸŽ¨', 'ðŸ–¼ï¸'],
    history: ['ðŸ“œ', 'ðŸ›ï¸'],
    math: ['ðŸ”¢', 'âž•', 'âž–', 'âœ–ï¸', 'âž—'],
    musicnote: ['ðŸŽ¶', 'ðŸŽµ'],
    headphone: ['ðŸŽ§'],
    microphone: ['ðŸŽ¤'],
    camera: ['ðŸ“·', 'ðŸ“¸'],
    video: ['ðŸ“¹', 'ðŸŽ¥'],
    tv: ['ðŸ“º'],
    laptop: ['ðŸ’»'],
    phonecall: ['ðŸ“ž'],
    watch: ['âŒš'],
    clock: ['â°', 'ðŸ•°ï¸'],
    calendar: ['ðŸ“…', 'ðŸ“†'],
    news: ['ðŸ“°', 'ðŸ—žï¸'],
    document: ['ðŸ“„', 'ðŸ“ƒ', 'ðŸ“‘'],
    folder: ['ðŸ“', 'ðŸ“‚'],
    file: ['ðŸ“‚', 'ðŸ“„'],
    chart: ['ðŸ“ˆ', 'ðŸ“‰', 'ðŸ“Š'],
    graph: ['ðŸ“Š', 'ðŸ“ˆ', 'ðŸ“‰'],
    pin: ['ðŸ“Œ', 'ðŸ“'],
    link: ['ðŸ”—'],
    key: ['ðŸ”‘', 'ðŸ—ï¸'],
    lock: ['ðŸ”’', 'ðŸ”'],
    unlock: ['ðŸ”“'],
    search: ['ðŸ”', 'ðŸ”Ž'],
    zoom: ['ðŸ”Ž', 'ðŸ”'],
    light: ['ðŸ’¡', 'ðŸ•¯ï¸'],
    dark: ['ðŸŒ‘', 'âš«'],
    happy: ['ðŸ˜„', 'ðŸ˜Š', 'ðŸ˜ƒ', 'ðŸ˜'],
    sad: ['ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜”', 'ðŸ˜ž'],
    angry: ['ðŸ˜ ', 'ðŸ˜¡', 'ðŸ˜¤'],
    laugh: ['ðŸ˜‚', 'ðŸ¤£'],
    cry: ['ðŸ˜­', 'ðŸ˜¢'],
    smile: ['ðŸ˜Š', 'ðŸ™‚', 'ðŸ˜„'],
    wink: ['ðŸ˜‰'],
    kiss: ['ðŸ˜˜', 'ðŸ’‹'],
    hug: ['ðŸ¤—'],
    think: ['ðŸ¤”', 'ðŸ§'],
    sleep: ['ðŸ˜´', 'ðŸ˜ª'],
    wave: ['ðŸ‘‹', 'ðŸŒŠ'],
    clap: ['ðŸ‘'],
    fist: ['âœŠ'],
    peace: ['âœŒï¸'],
    rock: ['ðŸ¤˜', 'ðŸ—¿'],
    muscle: ['ðŸ’ª'],
    brain: ['ðŸ§ '],
    ghost: ['ðŸ‘»'],
    alien: ['ðŸ‘½', 'ðŸ‘¾'],
    robot: ['ðŸ¤–'],
    poop: ['ðŸ’©'],
    hundred: ['ðŸ’¯'],
    boom: ['ðŸ’¥', 'ðŸ’£'],
    sweat: ['ðŸ’¦', 'ðŸ’§'],
    dash: ['ðŸ’¨'],
    hole: ['ðŸ•³ï¸'],
    bomb: ['ðŸ’£', 'ðŸ’¥'],
    knife: ['ðŸ”ª', 'ðŸ—¡ï¸'],
    gun: ['ðŸ”«'],
    pill: ['ðŸ’Š'],
    syringe: ['ðŸ’‰'],
    drop: ['ðŸ’§'],
    fireworks: ['ðŸŽ†', 'ðŸŽ‡'],
    sparkles: ['âœ¨', 'ðŸ’–'],
    star2: ['ðŸŒŸ'],
    dizzy: ['ðŸ’«', 'ðŸ˜µ'],
    comet: ['â˜„ï¸'],
    rainbow: ['ðŸŒˆ'],
    umbrella: ['â˜”', 'â˜‚ï¸'],
    zap: ['âš¡', 'ðŸŒ©ï¸'],
    snowflake: ['â„ï¸'],
    snowman: ['â›„', 'â˜ƒï¸'],
    cyclone: ['ðŸŒ€'],
    foggy: ['ðŸŒ'],
    ocean: ['ðŸŒŠ', 'ðŸ’§'],
    cat2: ['ðŸˆ', 'ðŸ±'],
    dog2: ['ðŸ•', 'ðŸ¶'],
    mouse: ['ðŸ', 'ðŸ­'],
    hamster: ['ðŸ¹'],
    rabbit: ['ðŸ‡', 'ðŸ°'],
    fox: ['ðŸ¦Š'],
    bear: ['ðŸ»', 'ðŸ§¸'],
    panda: ['ðŸ¼'],
    koala: ['ðŸ¨'],
    tiger: ['ðŸ…', 'ðŸ¯'],
    lion: ['ðŸ¦'],
    cow: ['ðŸ„', 'ðŸ®'],
    pig: ['ðŸ–', 'ðŸ·'],
    frog: ['ðŸ¸'],
    octopus: ['ðŸ™'],
    shell: ['ðŸš'],
    bug: ['ðŸ›', 'ðŸž', 'ðŸœ', 'ðŸ•·ï¸'],
    ant: ['ðŸœ'],
    bee: ['ðŸ', 'ðŸ¯'],
    ladybug: ['ðŸž'],
    spider: ['ðŸ•·ï¸', 'ðŸ•¸ï¸'],
    scorpion: ['ðŸ¦‚'],
    crab: ['ðŸ¦€'],
    snake: ['ðŸ'],
    lizard: ['ðŸ¦Ž'],
    turtle: ['ðŸ¢'],
    fish: ['ðŸ ', 'ðŸŸ', 'ðŸŽ£'],
    dolphin: ['ðŸ¬'],
    whale: ['ðŸ‹', 'ðŸ³'],
    shark: ['ðŸ¦ˆ'],
    bird: ['ðŸ¦', 'ðŸ•Šï¸', 'ðŸ¦…', 'ðŸ¦†', 'ðŸ¦‰'],
    eagle: ['ðŸ¦…'],
    duck: ['ðŸ¦†'],
    owl: ['ðŸ¦‰'],
    bat: ['ðŸ¦‡'],
    wolf: ['ðŸº'],
    boar: ['ðŸ—'],
    horse: ['ðŸ´', 'ðŸŽ'],
    unicorn: ['ðŸ¦„'],
    zebra: ['ðŸ¦“'],
    deer: ['ðŸ¦Œ'],
    gorilla: ['ðŸ¦'],
    monkey: ['ðŸ’', 'ðŸµ'],
    rooster: ['ðŸ“'],
    chicken: ['ðŸ”', 'ðŸ—'],
    penguin: ['ðŸ§'],
    dodo: ['ðŸ¦¤'],
    sloth: ['ðŸ¦¥'],
    otter: ['ðŸ¦¦'],
    skunk: ['ðŸ¦¨'],
    kangaroo: ['ðŸ¦˜'],
    badger: ['ðŸ¦¡'],
    elephant: ['ðŸ˜'],
    rhino: ['ðŸ¦'],
    hippo: ['ðŸ¦›'],
    camel: ['ðŸ«', 'ðŸª'],
    giraffe: ['ðŸ¦’'],
    crocodile: ['ðŸŠ'],
    dragon: ['ðŸ‰', 'ðŸ²'],
    sauropod: ['ðŸ¦•'],
    trex: ['ðŸ¦–'],
    ram: ['ðŸ'],
    goat: ['ðŸ'],
    sheep: ['ðŸ‘'],
    poodle: ['ðŸ©'],
    turkey: ['ðŸ¦ƒ'],
    dove: ['ðŸ•Šï¸'],
    rat: ['ðŸ€'],
    chipmunk: ['ðŸ¿ï¸'],
    hedgehog: ['ðŸ¦”'],
    face: ['ðŸ™‚', 'ðŸ˜Š', 'ðŸ˜€', 'ðŸ˜”', 'ðŸ˜¡'],
    person: ['ðŸ§‘', 'ðŸ‘¨', 'ðŸ‘©'],
    man: ['ðŸ‘¨', 'ðŸ‘±â€â™‚ï¸', 'ðŸ§”'],
    woman: ['ðŸ‘©', 'ï¿½â€â™€ï¸', 'ï¿½ðŸ‘©â€ðŸ¦°'],
    boy: ['ðŸ‘¦'],
    girl: ['ðŸ‘§'],
    baby: ['ðŸ‘¶'],
    oldman: ['ðŸ‘´'],
    oldwoman: ['ðŸ‘µ'],
    police: ['ðŸ‘®', 'ðŸš“'],
    doctor: ['ðŸ‘¨â€âš•ï¸', 'ðŸ‘©â€âš•ï¸', 'ðŸ©º'],
    nurse: ['ðŸ‘©â€âš•ï¸', 'ðŸ‘¨â€âš•ï¸'],
    student: ['ðŸ‘¨â€ðŸŽ“', 'ðŸ‘©â€ðŸŽ“', 'ðŸŽ“'],
    teacher: ['ðŸ‘©â€ðŸ«', 'ðŸ‘¨â€ðŸ«'],
    judge: ['ðŸ‘¨â€âš–ï¸', 'ðŸ‘©â€âš–ï¸', 'âš–ï¸'],
    farmer: ['ðŸ‘¨â€ðŸŒ¾', 'ðŸ‘©â€ðŸŒ¾', 'ðŸšœ'],
    cook: ['ðŸ‘¨â€ðŸ³', 'ðŸ‘©â€ðŸ³', 'ðŸ³'],
    mechanic: ['ðŸ‘¨â€ðŸ”§', 'ðŸ‘©â€ðŸ”§', 'ðŸ”§'],
    factory: ['ðŸ­'],
    artist: ['ðŸ‘¨â€ðŸŽ¨', 'ðŸ‘©â€ðŸŽ¨', 'ðŸŽ¨'],
    pilot: ['ðŸ‘¨â€âœˆï¸', 'ðŸ‘©â€âœˆï¸', 'âœˆï¸'],
    astronaut: ['ðŸ‘¨â€ðŸš€', 'ðŸ‘©â€ðŸš€', 'ðŸš€'],
    firefighter: ['ðŸ‘¨â€ðŸš’', 'ðŸ‘©â€ðŸš’', 'ðŸš’'],
    prince: ['ðŸ¤´'],
    princess: ['ðŸ‘¸'],
    superhero: ['ðŸ¦¸', 'ðŸ¦¸â€â™‚ï¸', 'ðŸ¦¸â€â™€ï¸'],
    villain: ['ðŸ¦¹', 'ðŸ¦¹â€â™‚ï¸', 'ðŸ¦¹â€â™€ï¸'],
    ninja: ['ðŸ¥·'],
    zombie: ['ðŸ§Ÿ', 'ðŸ§Ÿâ€â™‚ï¸', 'ðŸ§Ÿâ€â™€ï¸'],
    elf: ['ðŸ§', 'ðŸ§â€â™‚ï¸', 'ðŸ§â€â™€ï¸'],
    genie: ['ðŸ§ž', 'ðŸ§žâ€â™‚ï¸', 'ðŸ§žâ€â™€ï¸'],
    vampire: ['ðŸ§›', 'ðŸ§›â€â™‚ï¸', 'ðŸ§›â€â™€ï¸'],
    mermaid: ['ðŸ§œ', 'ðŸ§œâ€â™‚ï¸', 'ðŸ§œâ€â™€ï¸'],
    fairy: ['ðŸ§š', 'ðŸ§šâ€â™‚ï¸', 'ðŸ§šâ€â™€ï¸'],
    angel: ['ðŸ‘¼'],
    santa: ['ðŸŽ…'],
    mrsclaus: ['ðŸ¤¶'],
    dancer: ['ðŸ’ƒ', 'ðŸ•º'],
    runner: ['ðŸƒ', 'ðŸƒâ€â™€ï¸', 'ðŸƒâ€â™‚ï¸'],
    swimmer: ['ðŸŠ', 'ðŸŠâ€â™€ï¸', 'ðŸŠâ€â™‚ï¸'],
    surfer: ['ðŸ„', 'ðŸ„â€â™€ï¸', 'ðŸ„â€â™‚ï¸'],
    skier: ['â›·ï¸'],
    snowboarder: ['ðŸ‚'],
    golfer: ['ðŸŒï¸', 'ðŸŒï¸â€â™€ï¸', 'ðŸŒï¸â€â™‚ï¸'],
    biker: ['ðŸš´', 'ðŸš´â€â™€ï¸', 'ðŸš´â€â™‚ï¸'],
    weightlifter: ['ðŸ‹ï¸', 'ðŸ‹ï¸â€â™€ï¸', 'ðŸ‹ï¸â€â™‚ï¸'],
    boxer: ['ðŸ¥Š'],
    martialarts: ['ðŸ¥‹'],
    wrestler: ['ðŸ¤¼', 'ðŸ¤¼â€â™€ï¸', 'ðŸ¤¼â€â™‚ï¸'],
    gymnast: ['ðŸ¤¸', 'ðŸ¤¸â€â™€ï¸', 'ðŸ¤¸â€â™‚ï¸'],
    juggler: ['ðŸ¤¹', 'ðŸ¤¹â€â™€ï¸', 'ðŸ¤¹â€â™‚ï¸'],
    magician: ['ðŸ§™', 'ðŸ§™â€â™€ï¸', 'ðŸ§™â€â™‚ï¸'],
    clown: ['ðŸ¤¡'],
    mummy: ['ðŸ§Ÿ'],
    troll: ['ðŸ§Œ'],
    ogre: ['ðŸ‘¹'],
    goblin: ['ðŸ‘º'],
    skeleton: ['ðŸ’€'],
    skull: ['â˜ ï¸', 'ðŸ’€'],
    jackolantern: ['ðŸŽƒ'],
    gift: ['ðŸŽ'],
    balloon: ['ðŸŽˆ'],
    confetti: ['ðŸŽŠ'],
    tada: ['ðŸŽ‰'],
    trophy: ['ðŸ†'],
    medal: ['ðŸ…', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'],
    prize: ['ðŸ¥‡'],
    soccer: ['âš½'],
    baseball: ['âš¾'],
    basketball: ['ðŸ€'],
    volleyball: ['ðŸ'],
    football: ['ðŸˆ'],
    rugby: ['ðŸ‰'],
    tennis: ['ðŸŽ¾', 'ÏÎ±ÎºÎ­Ï„Î±'],
    bowling: ['ðŸŽ³'],
    cricket: ['ðŸ'],
    fieldhockey: ['ðŸ‘'],
    icehockey: ['ðŸ’'],
    lacrosse: ['ðŸ¥'],
    pingpong: ['ðŸ“'],
    badminton: ['ðŸ¸'],
    boxing: ['ðŸ¥Š'],
    ice_skate: ['â›¸ï¸'],
    fishing: ['ðŸŽ£'],
    running: ['ðŸƒâ€â™€ï¸', 'ðŸƒ', 'ðŸƒâ€â™‚ï¸'],
    ski: ['ðŸŽ¿'],
    sled: ['ðŸ›·'],
    curling: ['ðŸ¥Œ'],
    dart: ['ðŸŽ¯'],
    yo_yo: ['ðŸª€'],
    kite: ['ðŸª'],
    '8ball': ['ðŸŽ±'],
    crystal_ball: ['ðŸ”®'],
    nazar_amulet: ['ðŸ§¿'],
    joystick: ['ðŸ•¹ï¸'],
    slot_machine: ['ðŸŽ°'],
    die: ['ðŸŽ²'],
    puzzle: ['ðŸ§©'],
    chess: ['â™Ÿï¸'],
    mahjong: ['ðŸ€„'],
    flower_playing_cards: ['ðŸŽ´'],
    performing_arts: ['ðŸŽ­'],
    frame_with_picture: ['ðŸ–¼ï¸'],
    artist_palette: ['ðŸŽ¨'],
    thread: ['ðŸ§µ'],
    yarn: ['ðŸ§¶'],
    glove: ['ðŸ§¤'],
    scarf: ['ðŸ§£'],
    coat: ['ðŸ§¥', 'ðŸ‘š'],
    socks: ['ðŸ§¦'],
    dress: ['ðŸ‘—'],
    kimono: ['ðŸ‘˜'],
    sari: ['ðŸ¥»'],
    one_piece_swimsuit: ['ðŸ©±'],
    briefs: ['ðŸ©²'],
    shorts: ['ðŸ©³'],
    bikini: ['ðŸ‘™'],
    womans_clothes: ['ðŸ‘š'],
    purse: ['ðŸ‘›'],
    handbag: ['ðŸ‘œ'],
    clutch_bag: ['ðŸ‘'],
    shopping_bags: ['ðŸ›ï¸'],
    school_satchel: ['ðŸŽ’'],
    thong_sandal: ['ðŸ©´'],
    mans_shoe: ['ðŸ‘ž'],
    athletic_shoe: ['ðŸ‘Ÿ'],
    hiking_boot: ['ðŸ¥¾'],
    flat_shoe: ['ðŸ¥¿'],
    high_heeled_shoe: ['ðŸ‘ '],
    womans_sandal: ['ðŸ‘¡'],
    ballet_shoes: ['ðŸ©°'],
    womans_boot: ['ðŸ‘¢'],
    crown: ['ðŸ‘‘'],
    womans_hat: ['ðŸ‘’'],
    top_hat: ['ðŸŽ©'],
    graduation_cap: ['ðŸŽ“'],
    billed_cap: ['ðŸ§¢'],
    military_helmet: ['ðŸª–'],
    rescue_workers_helmet: ['â›‘ï¸'],
    prayer_beads: ['ðŸ“¿'],
    lipstick: ['ðŸ’„'],
    ring: ['ðŸ’'],
    gem_stone: ['ðŸ’Ž'],
    muted_speaker: ['ðŸ”‡'],
    speaker_low_volume: ['ðŸ”ˆ'],
    speaker_medium_volume: ['ðŸ”‰'],
    speaker_high_volume: ['ðŸ”Š'],
    loudspeaker: ['ðŸ“¢'],
    megaphone: ['ðŸ“£'],
    postal_horn: ['ðŸ“¯'],
    bell: ['ðŸ””'],
    no_bell: ['ðŸ”•'],
    musical_score: ['ðŸŽ¼'],
    musical_note: ['ðŸŽµ'],
    musical_notes: ['ðŸŽ¶'],
    studio_microphone: ['ðŸŽ™ï¸'],
    level_slider: ['ðŸŽšï¸'],
    control_knobs: ['ðŸŽ›ï¸'],
    headphones: ['ðŸŽ§'],
    radio: ['ðŸ“»'],
    saxophone: ['ðŸŽ·'],
    accordion: ['ðŸª—'],
    guitar: ['ðŸŽ¸'],
    musical_keyboard: ['ðŸŽ¹'],
    trumpet: ['ðŸŽº'],
    violin: ['ðŸŽ»'],
    banjo: ['ðŸª•'],
    drum: ['ðŸ¥'],
    long_drum: ['ðŸª˜'],
    mobile_phone: ['ðŸ“±'],
    mobile_phone_with_arrow: ['ðŸ“²'],
    telephone: ['â˜Žï¸'],
    telephone_receiver: ['ðŸ“ž'],
    pager: ['ðŸ“Ÿ'],
    fax_machine: ['ðŸ“ '],
    battery: ['ðŸ”‹'],
    electric_plug: ['ðŸ”Œ'],
    desktop_computer: ['ðŸ–¥ï¸'],
    printer: ['ðŸ–¨ï¸'],
    keyboard: ['âŒ¨ï¸'],
    computer_mouse: ['ðŸ–±ï¸'],
    trackball: ['ðŸ–²ï¸'],
    computer_disk: ['ðŸ’½'],
    floppy_disk: ['ðŸ’¾'],
    optical_disk: ['ðŸ’¿'],
    dvd: ['ðŸ“€'],
    abacus: ['ðŸ§®'],
    movie_camera: ['ðŸŽ¥'],
    film_frames: ['ðŸŽžï¸'],
    film_projector: ['ðŸ“½ï¸'],
    clapper_board: ['ðŸŽ¬'],
    television: ['ðŸ“º'],
    camera_with_flash: ['ðŸ“¸'],
    video_camera: ['ðŸ“¹'],
    videocassette: ['ðŸ“¼'],
    magnifying_glass_tilted_left: ['ðŸ”'],
    magnifying_glass_tilted_right: ['ðŸ”Ž'],
    candle: ['ðŸ•¯ï¸'],
    light_bulb: ['ðŸ’¡'],
    flashlight: ['ðŸ”¦'],
    red_paper_lantern: ['ðŸ®'],
    diya_lamp: ['ðŸª”'],
    notebook_with_decorative_cover: ['ðŸ“”'],
    closed_book: ['ðŸ“•'],
    open_book: ['ðŸ“–'],
    green_book: ['ðŸ“—'],
    blue_book: ['ðŸ“˜'],
    orange_book: ['ðŸ“™'],
    books: ['ðŸ“š'],
    notebook: ['ðŸ““'],
    ledger: ['ðŸ“’'],
    page_with_curl: ['ðŸ“ƒ'],
    scroll: ['ðŸ“œ'],
    page_facing_up: ['ðŸ“„'],
    newspaper: ['ðŸ“°'],
    rolled_up_newspaper: ['ðŸ—žï¸'],
    bookmark_tabs: ['ðŸ“‘'],
    bookmark: ['ðŸ”–'],
    label: ['ðŸ·ï¸'],
    money_bag: ['ðŸ’°'],
    coin: ['ðŸª™'],
    yen_banknote: ['ðŸ’´'],
    dollar_banknote: ['ðŸ’µ'],
    euro_banknote: ['ðŸ’¶'],
    pound_banknote: ['ðŸ’·'],
    money_with_wings: ['ðŸ’¸'],
    credit_card: ['ðŸ’³'],
    receipt: ['ðŸ§¾'],
    chart_increasing_with_yen: ['ðŸ’¹'],
    envelope: ['âœ‰ï¸'],
    e_mail: ['ðŸ“§'],
    incoming_envelope: ['ðŸ“¨'],
    envelope_with_arrow: ['ðŸ“©'],
    outbox_tray: ['ðŸ“¤'],
    inbox_tray: ['ðŸ“¥'],
    package: ['ðŸ“¦'],
    closed_mailbox_with_raised_flag: ['ðŸ“«'],
    closed_mailbox_with_lowered_flag: ['ðŸ“ª'],
    open_mailbox_with_raised_flag: ['ðŸ“¬'],
    open_mailbox_with_lowered_flag: ['ðŸ“­'],
    postbox: ['ðŸ“®'],
    ballot_box_with_ballot: ['ðŸ—³ï¸'],
    pencil: ['âœï¸'],
    black_nib: ['âœ’ï¸'],
    fountain_pen: ['ðŸ–‹ï¸'],
    pen: ['ðŸ–Šï¸'],
    paintbrush: ['ðŸ–Œï¸'],
    crayon: ['ðŸ–ï¸'],
    memo: ['ðŸ“'],
    briefcase: ['ðŸ’¼'],
    file_folder: ['ðŸ“'],
    open_file_folder: ['ðŸ“‚'],
    card_index_dividers: ['ðŸ—‚ï¸'],
    tear_off_calendar: ['ðŸ“†'],
    spiral_notepad: ['ðŸ—’ï¸'],
    spiral_calendar: ['ðŸ—“ï¸'],
    card_index: ['ðŸ“‡'],
    chart_increasing: ['ðŸ“ˆ'],
    chart_decreasing: ['ðŸ“‰'],
    bar_chart: ['ðŸ“Š'],
    clipboard: ['ðŸ“‹'],
    pushpin: ['ðŸ“Œ'],
    round_pushpin: ['ðŸ“'],
    paperclip: ['ðŸ“Ž'],
    linked_paperclips: ['ðŸ–‡ï¸'],
    straight_ruler: ['ðŸ“'],
    triangular_ruler: ['ðŸ“'],
    scissors: ['âœ‚ï¸'],
    card_file_box: ['ðŸ—ƒï¸'],
    file_cabinet: ['ðŸ—„ï¸'],
    wastebasket: ['ðŸ—‘ï¸'],
    locked: ['ðŸ”’'],
    unlocked: ['ðŸ”“'],
    locked_with_pen: ['ðŸ”'],
    locked_with_key: ['ðŸ”'],
    old_key: ['ðŸ—ï¸'],
    hammer: ['ðŸ”¨'],
    axe: ['ðŸª“'],
    pick: ['â›ï¸'],
    hammer_and_pick: ['âš’ï¸'],
    hammer_and_wrench: ['ðŸ› ï¸'],
    dagger: ['ðŸ—¡ï¸'],
    crossed_swords: ['âš”ï¸'],
    pistol: ['ðŸ”«'],
    bow_and_arrow: ['ðŸ¹'],
    shield: ['ðŸ›¡ï¸'],
    wrench: ['ðŸ”§'],
    nut_and_bolt: ['ðŸ”©'],
    gear: ['âš™ï¸'],
    clamp: ['ðŸ—œï¸'],
    balance_scale: ['âš–ï¸'],
    white_cane: ['ðŸ¦¯'],
    chains: ['â›“ï¸'],
    toolbox: ['ðŸ§°'],
    magnet: ['ðŸ§²'],
    alembic: ['âš—ï¸'],
    test_tube: ['ðŸ§ª'],
    petri_dish: ['ðŸ§«'],
    dna: ['ðŸ§¬'],
    microscope: ['ðŸ”¬'],
    telescope: ['ðŸ”­'],
    satellite_antenna: ['ðŸ“¡'],
    stethoscope: ['ðŸ©º'],
    door: ['ðŸšª'],
    elevator: ['ðŸ›—'],
    mirror: ['ðŸªž'],
    window: ['ðŸªŸ'],
    bed: ['ðŸ›ï¸'],
    couch_and_lamp: ['ðŸ›‹ï¸'],
    chair: ['ðŸª‘'],
    toilet: ['ðŸš½'],
    plunger: ['ðŸª '],
    shower: ['ðŸš¿'],
    bathtub: ['ðŸ›'],
    mouse_trap: ['ðŸª¤'],
    razor: ['ðŸª’'],
    lotion_bottle: ['ðŸ§´'],
    safety_pin: ['ðŸ§·'],
    broom: ['ðŸ§¹'],
    basket: ['ðŸ§º'],
    roll_of_paper: ['ðŸ§»'],
    bucket: ['ðŸª£'],
    soap: ['ðŸ§¼'],
    toothbrush: ['ðŸª¥'],
    sponge: ['ðŸ§½'],
    fire_extinguisher: ['ðŸ§¯'],
    shopping_cart: ['ðŸ›’'],
    cigarette: ['ðŸš¬'],
    coffin: ['âš°ï¸'],
    headstone: ['ðŸª¦'],
    funeral_urn: ['âš±ï¸'],
    moai: ['ðŸ—¿'],
    placard: ['ðŸª§'],
    atm_sign: ['ðŸ§'],
    litter_in_bin_sign: ['ðŸš®'],
    potable_water: ['ðŸš°'],
    wheelchair_symbol: ['â™¿'],
    mens_room: ['ðŸš¹'],
    womens_room: ['ðŸšº'],
    restroom: ['ðŸš»'],
    baby_symbol: ['ðŸš¼'],
    water_closet: ['ðŸš¾'],
    passport_control: ['ðŸ›‚'],
    customs: ['ðŸ›ƒ'],
    baggage_claim: ['ðŸ›„'],
    left_luggage: ['ðŸ›…'],
    children_crossing: ['ðŸš¸'],
    no_entry: ['â›”'],
    prohibited: ['ðŸš«'],
    no_bicycles: ['ðŸš³'],
    no_smoking: ['ðŸš­'],
    no_littering: ['ðŸš¯'],
    non_potable_water: ['ðŸš±'],
    no_pedestrians: ['ðŸš·'],
    no_mobile_phones: ['ðŸ“µ'],
    no_one_under_eighteen: ['ðŸ”ž'],
    radioactive: ['â˜¢ï¸'],
    biohazard: ['â˜£ï¸'],
    up_arrow: ['â¬†ï¸'],
    up_right_arrow: ['â†—ï¸'],
    right_arrow: ['âž¡ï¸'],
    down_right_arrow: ['â†˜ï¸'],
    down_arrow: ['â¬‡ï¸'],
    down_left_arrow: ['â†™ï¸'],
    left_arrow: ['â¬…ï¸'],
    up_left_arrow: ['â†–ï¸'],
    up_down_arrow: ['â†•ï¸'],
    left_right_arrow: ['â†”ï¸'],
    right_arrow_curving_left: ['â†©ï¸'],
    left_arrow_curving_right: ['â†ªï¸'],
    right_arrow_curving_up: ['â¤´ï¸'],
    right_arrow_curving_down: ['â¤µï¸'],
    clockwise_vertical_arrows: ['ðŸ”ƒ'],
    counterclockwise_arrows_button: ['ðŸ”„'],
    back_arrow: ['ðŸ”™'],
    end_arrow: ['ðŸ”š'],
    on_arrow: ['ðŸ”›'],
    soon_arrow: ['ðŸ”œ'],
    top_arrow: ['ðŸ”'],
    place_of_worship: ['ðŸ›'],
    atom_symbol: ['âš›ï¸'],
    om: ['ðŸ•‰ï¸'],
    star_of_david: ['âœ¡ï¸'],
    wheel_of_dharma: ['â˜¸ï¸'],
    yin_yang: ['â˜¯ï¸'],
    latin_cross: ['âœï¸'],
    orthodox_cross: ['â˜¦ï¸'],
    star_and_crescent: ['â˜ªï¸'],
    peace_symbol: ['â˜®ï¸'],
    menorah: ['ðŸ•Ž'],
    dotted_six_pointed_star: ['ðŸ”¯'],
    aries: ['â™ˆ'],
    taurus: ['â™‰'],
    gemini: ['â™Š'],
    cancer: ['â™‹'],
    leo: ['â™Œ'],
    virgo: ['â™'],
    libra: ['â™Ž'],
    scorpio: ['â™'],
    sagittarius: ['â™'],
    capricorn: ['â™‘'],
    aquarius: ['â™’'],
    pisces: ['â™“'],
    ophiuchus: ['â›Ž'],
    shuffle_tracks_button: ['ðŸ”€'],
    repeat_button: ['ðŸ”'],
    repeat_single_button: ['ðŸ”‚'],
    play_button: ['â–¶ï¸'],
    fast_forward_button: ['â©'],
    next_track_button: ['â­ï¸'],
    play_or_pause_button: ['â¯ï¸'],
    reverse_button: ['â—€ï¸'],
    fast_reverse_button: ['âª'],
    last_track_button: ['â®ï¸'],
    upwards_button: ['ðŸ”¼'],
    fast_up_button: ['â«'],
    downwards_button: ['ðŸ”½'],
    fast_down_button: ['â¬'],
    pause_button: ['â¸ï¸'],
    stop_button: ['â¹ï¸'],
    record_button: ['âºï¸'],
    eject_button: ['âï¸'],
    cinema: ['ðŸŽ¦'],
    dim_button: ['ðŸ”…'],
    bright_button: ['ðŸ”†'],
    antenna_bars: ['ðŸ“¶'],
    vibration_mode: ['ðŸ“³'],
    mobile_phone_off: ['ðŸ“´'],
    female_sign: ['â™€ï¸'],
    male_sign: ['â™‚ï¸'],
    transgender_symbol: ['âš§ï¸'],
    multiply: ['âœ–ï¸'],
    plus: ['âž•'],
    minus: ['âž–'],
    divide: ['âž—'],
    infinity: ['â™¾ï¸'],
    double_exclamation_mark: ['â€¼ï¸'],
    exclamation_question_mark: ['â‰ï¸'],
    red_question_mark: ['â“'],
    white_question_mark: ['â”'],
    white_exclamation_mark: ['â•'],
    red_exclamation_mark: ['â—'],
    wavy_dash: ['ã€°ï¸'],
    currency_exchange: ['ðŸ’±'],
    heavy_dollar_sign: ['ðŸ’²'],
    medical: ['âš•ï¸'],
    recycling_symbol: ['â™»ï¸'],
    fleur_de_lis: ['âšœï¸'],
    trident_emblem: ['ðŸ”±'],
    name_badge: ['ðŸ“›'],
    japanese_symbol_for_beginner: ['ðŸ”°'],
    hollow_red_circle: ['â­•'],
    check_mark_button: ['âœ…'],
    check_box_with_check: ['â˜‘ï¸'],
    check_mark: ['âœ”ï¸'],
    cross_mark: ['âŒ'],
    cross_mark_button: ['âŽ'],
    curly_loop: ['âž°'],
    double_curly_loop: ['âž¿'],
    part_alternation_mark: ['ã€½ï¸'],
    eight_spoked_asterisk: ['âœ³ï¸'],
    eight_pointed_star: ['âœ´ï¸'],
    sparkle: ['â‡ï¸'],
    copyright: ['Â©ï¸'],
    registered: ['Â®ï¸'],
    trade_mark: ['â„¢ï¸'],
    keycap_hash: ['#ï¸âƒ£'],
    keycap_asterisk: ['*ï¸âƒ£'],
    keycap_0: ['0ï¸âƒ£'],
    keycap_1: ['1ï¸âƒ£'],
    keycap_2: ['2ï¸âƒ£'],
    keycap_3: ['3ï¸âƒ£'],
    keycap_4: ['4ï¸âƒ£'],
    keycap_5: ['5ï¸âƒ£'],
    keycap_6: ['6ï¸âƒ£'],
    keycap_7: ['7ï¸âƒ£'],
    keycap_8: ['8ï¸âƒ£'],
    keycap_9: ['9ï¸âƒ£'],
    keycap_10: ['ðŸ”Ÿ'],
    input_latin_uppercase: ['ðŸ” '],
    input_latin_lowercase: ['ðŸ”¡'],
    input_numbers: ['ðŸ”¢'],
    input_symbols: ['ðŸ”£'],
    input_latin_letters: ['ðŸ”¤'],
    a_button_blood_type: ['ðŸ…°ï¸'],
    ab_button_blood_type: ['ðŸ†Ž'],
    b_button_blood_type: ['ðŸ…±ï¸'],
    cl_button: ['ðŸ†‘'],
    cool_button: ['ðŸ†’'],
    free_button: ['ðŸ†“'],
    information: ['â„¹ï¸'],
    id_button: ['ðŸ†”'],
    circled_m: ['â“‚ï¸'],
    new_button: ['ðŸ†•'],
    ng_button: ['ðŸ†–'],
    o_button_blood_type: ['ðŸ…¾ï¸'],
    ok_button: ['ðŸ†—'],
    p_button: ['ðŸ…¿ï¸'],
    sos_button: ['ðŸ†˜'],
    up_button: ['ðŸ†™'],
    vs_button: ['ðŸ†š'],
    japanese_here_button: ['ðŸˆ'],
    japanese_service_charge_button: ['ðŸˆ‚ï¸'],
    japanese_monthly_amount_button: ['ðŸˆ·ï¸'],
    japanese_not_free_of_charge_button: ['ðŸˆ¶'],
    japanese_reserved_button: ['ðŸˆ¯'],
    japanese_bargain_button: ['ðŸ‰'],
    japanese_discount_button: ['ðŸˆ¹'],
    japanese_free_of_charge_button: ['ðŸˆš'],
    japanese_prohibited_button: ['ðŸˆ²'],
    japanese_acceptable_button: ['ðŸ‰‘'],
    japanese_application_button: ['ðŸˆ¸'],
    japanese_passing_grade_button: ['ðŸˆ´'],
    japanese_vacancy_button: ['ðŸˆ³'],
    red_circle: ['ðŸ”´'],
    orange_circle: ['ðŸŸ '],
    yellow_circle: ['ðŸŸ¡'],
    green_circle: ['ðŸŸ¢'],
    blue_circle: ['ðŸ”µ'],
    purple_circle: ['ðŸŸ£'],
    brown_circle: ['ðŸŸ¤'],
    black_circle: ['âš«'],
    white_circle: ['âšª'],
    red_square: ['ðŸŸ¥'],
    orange_square: ['ðŸŸ§'],
    yellow_square: ['ðŸŸ¨'],
    green_square: ['ðŸŸ©'],
    blue_square: ['ðŸŸ¦'],
    purple_square: ['ðŸŸª'],
    brown_square: ['ðŸŸ«'],
    black_large_square: ['â¬›'],
    white_large_square: ['â¬œ'],
    black_medium_square: ['â—¼ï¸'],
    white_medium_square: ['â—»ï¸'],
    black_medium_small_square: ['â—¾'],
    white_medium_small_square: ['â—½'],
    black_small_square: ['â–ªï¸'],
    white_small_square: ['â–«ï¸'],
    large_orange_diamond: ['ðŸ”¶'],
    large_blue_diamond: ['ðŸ”·'],
    small_orange_diamond: ['ðŸ”¸'],
    small_blue_diamond: ['ðŸ”¹'],
    red_triangle_pointed_up: ['ðŸ”º'],
    red_triangle_pointed_down: ['ðŸ”»'],
    diamond_with_a_dot: ['ðŸ’ '],
    radio_button: ['ðŸ”˜'],
    white_square_button: ['ðŸ”³'],
    black_square_button: ['ðŸ”²'],
    chequered_flag: ['ðŸ'],
    triangular_flag_on_post: ['ðŸš©'],
    crossed_flags: ['ðŸŽŒ'],
    black_flag: ['ðŸ´'],
    white_flag: ['ðŸ³ï¸'],
    rainbow_flag: ['ðŸ³ï¸â€ðŸŒˆ'],
    transgender_flag: ['ðŸ³ï¸â€âš§ï¸'],
    pirate_flag: ['ðŸ´â€â˜ ï¸'],
    // Add more mappings as needed
};

const fallbackEmojis = ['ðŸŽ²', 'ðŸ¤¯', 'â“', 'ðŸ¤”', 'ðŸ¤·', 'ðŸ¤¦', 'ðŸ’”', 'ðŸ’¥', 'âœ¨', 'ðŸ‘½', 'ðŸ¤–', 'ðŸ‘»'];

function getKeywordFromImage(img) {
    if (img.alt) {
        const altKeywords = img.alt.split(/[\s\-_.]+/);
        for (const keyword of altKeywords) {
            if (emojiMap[keyword]) return keyword;
        }
    }
    if (img.title) {
        const titleKeywords = img.title.split(/[\s\-_.]+/);
        for (const keyword of titleKeywords) {
            if (emojiMap[keyword]) return keyword;
        }
    }
    if (img.src) {
        const filename = img.src.split(/[\?]/)[0]; // Get the part before any query parameters
        const filenameKeywords = filename.split(/[\s\-_.]/);
        for (const keyword of filenameKeywords) {
            if (emojiMap[keyword]) return keyword;
        }
        // Check path segments
        const pathSegments = filename.split('/');
        for (let i = pathSegments.length - 2; i >= 0; i--) {
            const segment = pathSegments[i];
            if(emojiMap[segment]) return segment;
        }
    }
    return null;
}


function replaceImageWithEmoji(img, chaosMode = false) {
    if (img.classList.contains('emoji-fallback-processed')) {
        return; // Already processed
    }

    const keyword = getKeywordFromImage(img);
    let emoji;
    if (keyword && emojiMap[keyword]) {
        const emojis = emojiMap[keyword];
        if (Array.isArray(emojis) && emojis.length > 0) {
            emoji = emojis[Math.floor(Math.random() * emojis.length)];
        } else {
            emoji = emojis; // Fallback for single emoji strings
        }
    }
    
    if (!emoji) {
        emoji = fallbackEmojis[Math.floor(Math.random() * fallbackEmojis.length)];
    }

    const span = document.createElement('span');
    span.textContent = emoji;
    span.className = 'emoji-fallback';

    // Maintain aspect ratio and size
    const width = img.width || 100;
    const height = img.height || 100;

    // Style the fallback span
    span.style.width = `${width}px`;
    span.style.height = `${height}px`;
    span.style.display = 'inline-block';
    span.style['text-align'] = 'center';
    span.style['line-height'] = `${height}px`;
    span.style['font-size'] = `${Math.min(width, height)}px`;
    span.style['animation'] = 'fadeIn 0.5s';

    // Replace the image
    if (img.parentNode) {
        img.parentNode.replaceChild(span, img);
    }

    // Mark as processed
    span.classList.add('emoji-fallback-processed');
}

function handleAllImages(chaosMode) {
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        if (chaosMode) {
            // In chaos mode, replace immediately if the image is already loaded,
            // or set an onload handler to replace it once it loads.
            // This ensures even working images are replaced.
            if (img.complete) {
                replaceImageWithEmoji(img, true);
            } else {
                img.onload = () => replaceImageWithEmoji(img, true);
                // Also handle errors in case it breaks while chaos mode is on
                img.onerror = () => replaceImageWithEmoji(img);
            }
        } else {
            // If not in chaos mode, only set the error handler.
            img.onerror = () => replaceImageWithEmoji(img);
        }
        // Add a class to prevent re-processing
        img.classList.add('emoji-fallback-processed');
    });
}


// Initial run
chrome.storage.sync.get('chaosMode', (data) => {
    handleAllImages(!!data.chaosMode);
});

// Listen for changes in chaos mode
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
    if (request.chaosMode !== undefined) {
        // Re-evaluate all images when chaos mode changes
        // Reset processed flags to re-apply logic
        document.querySelectorAll('.emoji-fallback-processed').forEach(el => el.classList.remove('emoji-fallback-processed'));
        const images = document.querySelectorAll('img');
        images.forEach(img => {
            // If we are turning chaos mode on, we need to re-process all images.
            // If we are turning it off, we should ideally restore original images,
            // but for simplicity, we'll just stop replacing new ones. A page refresh would be needed to restore.
            // A more advanced implementation would store the original src and put the img back.
        });
        handleAllImages(request.chaosMode);
    }
});

// Use a MutationObserver to detect images added to the DOM later
const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
            if (node.tagName === 'IMG') {
                 chrome.storage.sync.get('chaosMode', (data) => {
                    handleAllImages(!!data.chaosMode);
                });
            }
            // Also check for images inside added nodes
            if (node.querySelectorAll) {
                const newImages = node.querySelectorAll('img');
                if (newImages.length > 0) {
                     chrome.storage.sync.get('chaosMode', (data) => {
                        handleAllImages(!!data.chaosMode);
                    });
                }
            }
        });
    });
});

observer.observe(document.body, {
    childList: true,
    subtree: true
});
